import os
from gtts import gTTS
from moviepy.editor import *
from telegram.ext import Updater, MessageHandler, Filters
import datetime

# Telegram Bot Token
TOKEN = os.getenv("8269322609:AAElFFE5YJ-ehl47CXq0JpjYug-zSpiO7NY")

# Folder setup
os.makedirs("videos", exist_ok=True)

def make_video(text):
    """Text ‚Üí Audio + Video ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à"""
    tts = gTTS(text=text, lang='hi')
    audio_path = "audio.mp3"
    tts.save(audio_path)

    bg = "https://picsum.photos/1280/720"  # Random background
    clip = ImageClip(bg).set_duration(AudioFileClip(audio_path).duration)
    clip = clip.set_audio(AudioFileClip(audio_path))
    file_name = f"videos/video_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.mp4"
    clip.write_videofile(file_name, codec="libx264", audio_codec="aac")
    return file_name

def handle_message(update, context):
    """‡§ú‡§¨ user message ‡§≠‡•á‡§ú‡•á"""
    text = update.message.text
    update.message.reply_text("üé¨ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§¨‡§® ‡§∞‡§π‡§æ ‡§π‡•à, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç...")
    video_path = make_video(text)
    context.bot.send_video(chat_id=update.effective_chat.id, video=open(video_path, 'rb'))
    update.message.reply_text("‚úÖ ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§§‡•à‡§Ø‡§æ‡§∞! ‡§Ö‡§¨ ‡§Ü‡§™ ‡§á‡§∏‡•á YouTube ‡§™‡§∞ upload ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§")

updater = Updater(TOKEN, use_context=True)
dp = updater.dispatcher
dp.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_message))
updater.start_polling()
updater.idle()

